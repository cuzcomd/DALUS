function getZoneNumber(t,e){t=parseFloat(t),((e=parseFloat(e))>360||e<-180||t>84||t<-80)&&alert("usng.js, getZoneNumber: invalid input. lat: "+t.toFixed(4)+" lon: "+e.toFixed(4));var a=e+180-360*parseInt((e+180)/360)-180,r=parseInt((a+180)/6)+1;return t>=56&&t<64&&a>=3&&a<12&&(r=32),t>=72&&t<84&&(a>=0&&a<9?r=31:a>=9&&a<21?r=33:a>=21&&a<33?r=35:a>=33&&a<42&&(r=37)),r}function LLtoUTM(t,e,a,r){if(t=parseFloat(t),e=parseFloat(e),t>84||t<-80)return UNDEFINED_STR;(e>360||e<-180||t>90||t<-90)&&alert("usng.js, LLtoUTM, invalid input. lat: "+t.toFixed(4)+" lon: "+e.toFixed(4)),lonTemp=e+180-360*parseInt((e+180)/360)-180,latRad=t*DEG_2_RAD,lonRad=lonTemp*DEG_2_RAD,zoneNumber=r||getZoneNumber(t,e),lonOrigin=6*(zoneNumber-1)-180+3,lonOriginRad=lonOrigin*DEG_2_RAD,UTMZone=zoneNumber+""+UTMLetterDesignator(t)+" ",N=EQUATORIAL_RADIUS/Math.sqrt(1-ECC_SQUARED*Math.sin(latRad)*Math.sin(latRad)),T=Math.tan(latRad)*Math.tan(latRad),C=ECC_PRIME_SQUARED*Math.cos(latRad)*Math.cos(latRad),A=Math.cos(latRad)*(lonRad-lonOriginRad),M=EQUATORIAL_RADIUS*((1-ECC_SQUARED/4-ECC_SQUARED*ECC_SQUARED*3/64-ECC_SQUARED*ECC_SQUARED*ECC_SQUARED*5/256)*latRad-(3*ECC_SQUARED/8+3*ECC_SQUARED*ECC_SQUARED/32+45*ECC_SQUARED*ECC_SQUARED*ECC_SQUARED/1024)*Math.sin(2*latRad)+(15*ECC_SQUARED*ECC_SQUARED/256+45*ECC_SQUARED*ECC_SQUARED*ECC_SQUARED/1024)*Math.sin(4*latRad)-35*ECC_SQUARED*ECC_SQUARED*ECC_SQUARED/3072*Math.sin(6*latRad)),UTMEasting=k0*N*(A+(1-T+C)*(A*A*A)/6+(5-18*T+T*T+72*C-58*ECC_PRIME_SQUARED)*(A*A*A*A*A)/120)+EASTING_OFFSET,UTMNorthing=k0*(M+N*Math.tan(latRad)*(A*A/2+(5-T+9*C+4*C*C)*(A*A*A*A)/24+(61-58*T+T*T+600*C-330*ECC_PRIME_SQUARED)*(A*A*A*A*A*A)/720)),a[0]=UTMEasting,a[1]=UTMNorthing,a[2]=zoneNumber}function LLtoUSNG(t,e,a){e<-180?e+=360:e>180&&(e-=360);var r=[];LLtoUTM(t=parseFloat(t),e=parseFloat(e),r);var E=r[0],n=r[1];for(t<0&&(n+=NORTHING_OFFSET),USNGLetters=findGridLetters(zoneNumber,n,E),USNGNorthing=Math.round(n)%BLOCK_SIZE,USNGEasting=Math.round(E)%BLOCK_SIZE,USNGNorthing=Math.floor(USNGNorthing/Math.pow(10,5-a)),USNGEasting=Math.floor(USNGEasting/Math.pow(10,5-a)),USNG=getZoneNumber(t,e)+UTMLetterDesignator(t)+" "+USNGLetters+" ",i=String(USNGEasting).length;i<a;i++)USNG+="0";for(USNG+=USNGEasting+" ",i=String(USNGNorthing).length;i<a;i++)USNG+="0";return USNG+=USNGNorthing,USNG}function UTMLetterDesignator(t){return t=parseFloat(t),letterDesignator=84>=t&&t>=72?"X":72>t&&t>=64?"W":64>t&&t>=56?"V":56>t&&t>=48?"U":48>t&&t>=40?"T":40>t&&t>=32?"S":32>t&&t>=24?"R":24>t&&t>=16?"Q":16>t&&t>=8?"P":8>t&&t>=0?"N":0>t&&t>=-8?"M":-8>t&&t>=-16?"L":-16>t&&t>=-24?"K":-24>t&&t>=-32?"J":-32>t&&t>=-40?"H":-40>t&&t>=-48?"G":-48>t&&t>=-56?"F":-56>t&&t>=-64?"E":-64>t&&t>=-72?"D":-72>t&&t>=-80?"C":"Z",letterDesignator}function findSet(t){switch(t=parseInt(t),t%=6){case 0:return 6;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;default:return-1}}function findGridLetters(t,e,a){for(t=parseInt(t),e=parseFloat(e),a=parseFloat(a),row=1,north_1m=Math.round(e);north_1m>=BLOCK_SIZE;)north_1m-=BLOCK_SIZE,row++;for(row%=GRIDSQUARE_SET_ROW_SIZE,col=0,east_1m=Math.round(a);east_1m>=BLOCK_SIZE;)east_1m-=BLOCK_SIZE,col++;return col%=GRIDSQUARE_SET_COL_SIZE,lettersHelper(findSet(t),row,col)}function lettersHelper(t,e,a){switch(0==e?e=GRIDSQUARE_SET_ROW_SIZE-1:e--,0==a?a=GRIDSQUARE_SET_COL_SIZE-1:a--,t){case 1:return l1="ABCDEFGH",l2="ABCDEFGHJKLMNPQRSTUV",l1.charAt(a)+l2.charAt(e);case 2:return l1="JKLMNPQR",l2="FGHJKLMNPQRSTUVABCDE",l1.charAt(a)+l2.charAt(e);case 3:return l1="STUVWXYZ",l2="ABCDEFGHJKLMNPQRSTUV",l1.charAt(a)+l2.charAt(e);case 4:return l1="ABCDEFGH",l2="FGHJKLMNPQRSTUVABCDE",l1.charAt(a)+l2.charAt(e);case 5:return l1="JKLMNPQR",l2="ABCDEFGHJKLMNPQRSTUV",l1.charAt(a)+l2.charAt(e);case 6:return l1="STUVWXYZ",l2="FGHJKLMNPQRSTUVABCDE",l1.charAt(a)+l2.charAt(e)}}function UTMtoLL(t,e,a,r){var E=parseFloat(e)-EASTING_OFFSET,n=parseFloat(t),S=6*(parseInt(a)-1)-180+3,U=n/k0/(EQUATORIAL_RADIUS*(1-ECC_SQUARED/4-3*ECC_SQUARED*ECC_SQUARED/64-5*ECC_SQUARED*ECC_SQUARED*ECC_SQUARED/256)),A=U+(3*E1/2-27*E1*E1*E1/32)*Math.sin(2*U)+(21*E1*E1/16-55*E1*E1*E1*E1/32)*Math.sin(4*U)+151*E1*E1*E1/96*Math.sin(6*U),R=EQUATORIAL_RADIUS/Math.sqrt(1-ECC_SQUARED*Math.sin(A)*Math.sin(A)),o=Math.tan(A)*Math.tan(A),C=ECC_PRIME_SQUARED*Math.cos(A)*Math.cos(A),_=EQUATORIAL_RADIUS*(1-ECC_SQUARED)/Math.pow(1-ECC_SQUARED*Math.sin(A)*Math.sin(A),1.5),s=E/(R*k0),i=A-R*Math.tan(A)/_*(s*s/2-(5+3*o+10*C-4*C*C-9*ECC_PRIME_SQUARED)*s*s*s*s/24+(61+90*o+298*C+45*o*o-252*ECC_PRIME_SQUARED-3*C*C)*s*s*s*s*s*s/720);i*=RAD_2_DEG;var D=(s-(1+2*o+C)*s*s*s/6+(5-2*C+28*o-3*C*C+8*ECC_PRIME_SQUARED+24*o*o)*s*s*s*s*s/120)/Math.cos(A);D=S+D*RAD_2_DEG,r.lat=i,r.lon=D}function USNGtoUTM(t,e,a,r,E,n,S){var U=[1.1,2,2.9,3.8,4.7,5.6,6.5,7.3,8.2,9.1,0,.8,1.7,2.6,3.5,4.4,5.3,6.2,7,7.9],A=[0,2,2,2,4,4,6,6,8,8,0,0,0,2,2,4,4,6,6,6],R=1+USNGSqEast.indexOf(a)%8,o="CDEFGHJKLMNPQRSTUVWX".indexOf(e);if(t%2)C="ABCDEFGHJKLMNPQRSTUV".indexOf(r);else var C="FGHJKLMNPQRSTUVABCDE".indexOf(r);var _=U[o],s=Number(A[o])+C/10;s<_&&(s+=2),S.N=1e6*s+Number(n)*Math.pow(10,5-n.length),S.E=1e5*R+Number(E)*Math.pow(10,5-E.length),S.zone=t,S.letter=e}function USNGtoLL(t,e){var a=new Object;parseUSNG_str(t,a);var r=new Object;USNGtoUTM(a.zone,a.let,a.sq1,a.sq2,a.east,a.north,r),a.let<"N"&&(r.N-=NORTHING_OFFSET),UTMtoLL(r.N,r.E,a.zone,r),e[0]=r.lat,e[1]=r.lon}function parseUSNG_str(t,e){var a=0,r=[],E=[],n=/%20/g;if(r=(E=t.toUpperCase()).replace(n,""),n=/ /g,(r=E.replace(n,"")).length<7)return alert("This application requires minimum USNG precision of 10,000 meters"),0;e.zone=10*r.charAt(a++)+1*r.charAt(a++),e.let=r.charAt(a++),e.sq1=r.charAt(a++),e.sq2=r.charAt(a++),e.precision=(r.length-a)/2,e.east="",e.north="";for(S=0;S<e.precision;S++)e.east+=r.charAt(a++);" "==r[a]&&a++;for(var S=0;S<e.precision;S++)e.north+=r.charAt(a++)}function isUSNG(t){var e,a=[],r=/%20/g;return a=(a=t.toUpperCase()).replace(r,""),r=/ /g,(a=a.replace(r,"")).length>15?0:(e=new RegExp("^[0-9]{2}[CDEFGHJKLMNPQRSTUVWX]$"),a.match(e)?(alert("Input appears to be a UTM zone...more precision is required to display a correct result."),0):(e=new RegExp("^[0-9]{2}[CDEFGHJKLMNPQRSTUVWX][ABCDEFGHJKLMNPQRSTUVWXYZ][ABCDEFGHJKLMNPQRSTUV]([0-9][0-9]){0,5}$"),a.match(e)?a.length<7?(alert(a+" Appears to be a USNG string, but this application requires precision of at least 10,000 meters"),0):a:0))}function LLtoMGRS(t,e,a){return LLtoUSNG(t,e,a).replace(/ /g,"")}function GUsngtoLL(t){var e=[];return USNGtoLL(t,e),new GLatLng(e[0],e[1])}function LLtoUSNG_nad27(t,e,a){var r;return EQUATORIAL_RADIUS=6378206.4,ECC_SQUARED=.006768658,r=LLtoUSNG(t,e,a),EQUATORIAL_RADIUS=6378137,ECC_SQUARED=.006694380023,r+" (NAD27)"}var ngFunctionsPresent=!0,UNDEFINED_STR="undefined",UTMEasting,UTMNorthing,UTMZone,zoneNumber,FOURTHPI=Math.PI/4,DEG_2_RAD=Math.PI/180,RAD_2_DEG=180/Math.PI,BLOCK_SIZE=1e5,IS_NAD83_DATUM=!0,GRIDSQUARE_SET_COL_SIZE=8,GRIDSQUARE_SET_ROW_SIZE=20,EASTING_OFFSET=5e5,NORTHING_OFFSET=1e7,k0=.9996,EQUATORIAL_RADIUS,ECCENTRICTY_SQUARED,ECC_PRIME_SQUARED;IS_NAD83_DATUM?(EQUATORIAL_RADIUS=6378137,ECC_SQUARED=.006694380023):(EQUATORIAL_RADIUS=6378206.4,ECC_SQUARED=.006768658);var ECC_PRIME_SQUARED=ECC_SQUARED/(1-ECC_SQUARED),E1=(1-Math.sqrt(1-ECC_SQUARED))/(1+Math.sqrt(1-ECC_SQUARED)),UTMGzdLetters="NPQRSTUVWX",USNGSqEast="ABCDEFGHJKLMNPQRSTUVWXYZ",USNGSqLetOdd="ABCDEFGHJKLMNPQRSTUV",USNGSqLetEven="FGHJKLMNPQRSTUVABCDE";